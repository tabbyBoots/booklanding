@model mvcDapper3.Models.ViewModel.vmUserForm
@{
    ViewData["Title"] = Model.IsNewRecord ? "新增會員" : "編輯會員";
    Layout = "_BookLandingAdminLayout";
}

<!-- Header Actions -->
<div class="d-flex justify-content-between align-items-center mb-4" data-aos="fade-up">
    <div>
        <p class="text-muted mb-0">@(Model.IsNewRecord ? "建立新的會員資料" : "修改現有會員資料")</p>
    </div>
    <div>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-2"></i>返回列表
        </a>
    </div>
</div>

<!-- User Form Card -->
<div class="admin-card" data-aos="fade-up" data-aos-delay="100">
    <div class="admin-card-header">
        <h5 class="mb-0">
            <i class="bi bi-person-plus me-2"></i>@(Model.IsNewRecord ? "新增會員" : "編輯會員")
        </h5>
    </div>
    <div class="admin-card-body">
        <form asp-action="@(Model.IsNewRecord ? "Create" : "Edit")" method="post">
            <input type="hidden" name="currentPage" value="@ViewBag.CurrentPage" />

            @Html.AntiForgeryToken()
            @if (!Model.IsNewRecord)
            {
                <input type="hidden" asp-for="Id" />
            }
            <input type="hidden" asp-for="IsValid" />
            
            <!-- Basic Information Section -->
            <div class="form-section mb-4">
                <h6 class="section-title mb-3" style="font-family: var(--heading-font); color: var(--heading-color); border-bottom: 2px solid var(--accent-color); padding-bottom: 8px;">
                    <i class="bi bi-person me-2"></i>基本資料
                </h6>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="UserNo" class="form-label" style="font-family: var(--nav-font); font-weight: 500; color: var(--heading-color);">使用者編號</label>
                            <input asp-for="UserNo" class="form-control admin-form-control" style="border: 2px solid color-mix(in srgb, var(--default-color), transparent 85%); border-radius: 8px; padding: 12px 16px;" />
                            <span asp-validation-for="UserNo" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="UserName" class="form-label" style="font-family: var(--nav-font); font-weight: 500; color: var(--heading-color);">使用者姓名</label>
                            <input asp-for="UserName" class="form-control admin-form-control" style="border: 2px solid color-mix(in srgb, var(--default-color), transparent 85%); border-radius: 8px; padding: 12px 16px;" />
                            <span asp-validation-for="UserName" class="text-danger"></span>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="GenderName" class="form-label" style="font-family: var(--nav-font); font-weight: 500; color: var(--heading-color);">性別</label>
                            <select asp-for="GenderCode" class="form-control admin-form-control" asp-items="ViewBag.GenderList" style="border: 2px solid color-mix(in srgb, var(--default-color), transparent 85%); border-radius: 8px; padding: 12px 16px;">
                                <option value="">-- 請選擇性別 --</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="DeptName" class="form-label" style="font-family: var(--nav-font); font-weight: 500; color: var(--heading-color);">部門</label>
                            <select asp-for="DeptNo" class="form-control admin-form-control" asp-items="ViewBag.DeptList" style="border: 2px solid color-mix(in srgb, var(--default-color), transparent 85%); border-radius: 8px; padding: 12px 16px;">
                                <option value="">-- 請選擇部門 --</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="TitleName" class="form-label" style="font-family: var(--nav-font); font-weight: 500; color: var(--heading-color);">職稱</label>
                            <select asp-for="TitleNo" class="form-control admin-form-control" asp-items="ViewBag.TitleList" style="border: 2px solid color-mix(in srgb, var(--default-color), transparent 85%); border-radius: 8px; padding: 12px 16px;">
                                <option value="">-- 請選擇職稱 --</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="Birthday" class="form-label" style="font-family: var(--nav-font); font-weight: 500; color: var(--heading-color);">生日</label>
                            <input asp-for="Birthday" class="form-control admin-form-control datepicker" style="border: 2px solid color-mix(in srgb, var(--default-color), transparent 85%); border-radius: 8px; padding: 12px 16px;" />
                            <span asp-validation-for="Birthday" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="OnboardDate" class="form-label" style="font-family: var(--nav-font); font-weight: 500; color: var(--heading-color);">到職日期</label>
                            <input asp-for="OnboardDate" class="form-control admin-form-control datepicker" style="border: 2px solid color-mix(in srgb, var(--default-color), transparent 85%); border-radius: 8px; padding: 12px 16px;" />
                            <span asp-validation-for="OnboardDate" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Information Section -->
            <div class="form-section mb-4">
                <h6 class="section-title mb-3" style="font-family: var(--heading-font); color: var(--heading-color); border-bottom: 2px solid var(--accent-color); padding-bottom: 8px;">
                    <i class="bi bi-envelope me-2"></i>聯絡資訊
                </h6>
                
                <div class="row mb-3">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label asp-for="ContactEmail" class="form-label" style="font-family: var(--nav-font); font-weight: 500; color: var(--heading-color);">電子郵件</label>
                            <input asp-for="ContactEmail" class="form-control admin-form-control" type="email" style="border: 2px solid color-mix(in srgb, var(--default-color), transparent 85%); border-radius: 8px; padding: 12px 16px;" />
                            <span asp-validation-for="ContactEmail" class="text-danger"></span>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="ContactTel" class="form-label" style="font-family: var(--nav-font); font-weight: 500; color: var(--heading-color);">聯絡電話</label>
                            <input asp-for="ContactTel" class="form-control admin-form-control" style="border: 2px solid color-mix(in srgb, var(--default-color), transparent 85%); border-radius: 8px; padding: 12px 16px;" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="ContactAddress" class="form-label" style="font-family: var(--nav-font); font-weight: 500; color: var(--heading-color);">聯絡地址</label>
                            <input asp-for="ContactAddress" class="form-control admin-form-control" style="border: 2px solid color-mix(in srgb, var(--default-color), transparent 85%); border-radius: 8px; padding: 12px 16px;" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Role Information Section (Admin/Mis only) -->
            @if (User.IsInRole("Admin") || User.IsInRole("Mis"))
            {
                <div class="form-section mb-4">
                    <h6 class="section-title mb-3" style="font-family: var(--heading-font); color: var(--heading-color); border-bottom: 2px solid var(--accent-color); padding-bottom: 8px;">
                        <i class="bi bi-shield me-2"></i>權限設定
                    </h6>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label asp-for="RoleNo" class="form-label" style="font-family: var(--nav-font); font-weight: 500; color: var(--heading-color);">使用者角色</label>
                                <select asp-for="RoleNo" class="form-control admin-form-control" asp-items="ViewBag.RoleList" style="border: 2px solid color-mix(in srgb, var(--default-color), transparent 85%); border-radius: 8px; padding: 12px 16px;">
                                    <option value="">-- 請選擇角色 --</option>
                                </select>
                                <span asp-validation-for="RoleNo" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <!-- Hidden field for User role - preserve existing role -->
                <input type="hidden" asp-for="RoleNo" />
            }

            <!-- Additional Information Section -->
            <div class="form-section mb-4">
                <h6 class="section-title mb-3" style="font-family: var(--heading-font); color: var(--heading-color); border-bottom: 2px solid var(--accent-color); padding-bottom: 8px;">
                    <i class="bi bi-chat-text me-2"></i>備註資訊
                </h6>
                
                <div class="row mb-3">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label asp-for="Remark" class="form-label" style="font-family: var(--nav-font); font-weight: 500; color: var(--heading-color);">備註</label>
                            <textarea asp-for="Remark" class="form-control admin-form-control" rows="4" style="border: 2px solid color-mix(in srgb, var(--default-color), transparent 85%); border-radius: 8px; padding: 12px 16px; resize: vertical;"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="form-actions d-flex justify-content-end gap-3 pt-3" style="border-top: 1px solid color-mix(in srgb, var(--default-color), transparent 90%);">
                <a asp-action="Index" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-2"></i>返回列表
                </a>
                <button type="submit" class="btn btn-admin">
                    <i class="bi bi-check-lg me-2"></i>@(Model.IsNewRecord ? "建立會員" : "儲存變更")
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(function () {
            // Initialize date pickers using jQuery UI
            $(".datepicker").datepicker({
                dateFormat: "yy-mm-dd",
                changeMonth: true,
                changeYear: true,
                yearRange: "-100:+10",
                showButtonPanel: true,
                currentText: "Today",
                closeText: "Close"
            });

            // Set default date format for all date inputs
            $.validator.methods.date = function (value, element) {
                return this.optional(element) || moment(value, "YYYY-MM-DD", true).isValid();
            };
        });
    </script>
}
